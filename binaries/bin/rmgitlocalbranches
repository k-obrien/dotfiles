#!/usr/bin/env zsh

error_exit() {
    echo "$1" >&2
    exit 1
}

[[ -z "$1" ]] || [[ "$1" == "-d" ]] || [[ "$1" == "-D" ]] || error_exit "Usage: rmgitlocal [options]\n\t-[dD]\tDelete merged branches"

git remote prune origin

branches=($(git branch -vv | grep 'origin/.*: gone]' | awk '{print $1}'))

for branch in "${branches[@]}"; do
    if [[ -z "$1" ]]; then
        echo "${branch}"
    else
        git branch "${1}" "${branch}"
    fi
done
