#!/usr/bin/env zsh

source common

_depend_on git

usage="Usage: ${0##*/} -[dD]
    -d\tDelete fully merged branches
    -D\tDelete all merged branches"

_prune_remote() {
    echo "Pruning remote branches..."
    git remote prune origin
}

_prune_local() {
    git branch -vv | grep 'origin/.*: gone]' | awk '{print $1}'
}

case "$1" in
    "")
        _prune_remote
        branches=($(_prune_local))
        printf "%s\n" "${branches[@]}"
        ;;

    -d | -D)
        _prune_remote
        branches=($(_prune_local))
        for branch in "${branches[@]}"; do
            git branch "$1" "$branch"
        done
        ;;
    
    *)
        _error_exit $usage
        ;;
esac
